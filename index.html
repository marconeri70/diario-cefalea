<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>Diario Cefalea</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <link rel="stylesheet" href="./style.css" />
</head>

<body>

  <!-- HEADER -->
  <header class="app-header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">üß†</div>
        <div class="brand-text">
          <h1>Diario Cefalea</h1>
          <div class="subtitle">Registro attacchi ‚Ä¢ Report mensile ‚Ä¢ Grafici ‚Ä¢ Offline</div>
        </div>
      </div>

      <div class="header-actions">
        <button id="btnInstall" class="btn btn-ghost" hidden>üì≤ Installa</button>
      </div>
    </div>

    <!-- TABS -->
    <nav class="tabs" aria-label="Navigazione">
      <button class="tab active" data-view="diario" data-accent="blue" type="button">
        <span class="tab-ico" aria-hidden="true">üìù</span>
        <span class="tab-label">Diario</span>
      </button>

      <button class="tab" data-view="statistiche" data-accent="cyan" type="button">
        <span class="tab-ico" aria-hidden="true">üìä</span>
        <span class="tab-label">Statistiche</span>
      </button>

      <button class="tab" data-view="report" data-accent="amber" type="button">
        <span class="tab-ico" aria-hidden="true">üè•</span>
        <span class="tab-label">Report PDF</span>
      </button>

      <button class="tab" data-view="impostazioni" data-accent="violet" type="button">
        <span class="tab-ico" aria-hidden="true">‚öôÔ∏è</span>
        <span class="tab-label">Impostazioni</span>
      </button>
    </nav>
  </header>

  <main class="container">

    <!-- =======================
         VIEW: DIARIO
         ======================= -->
    <section id="view-diario" class="view active">

      <!-- Intestazione -->
      <div class="card" id="card-intestazione">
        <div class="section-title">
          <h2>Dati intestazione</h2>
          <span class="pill pill-blue">Per il PDF</span>
        </div>

        <label for="patientName">Nome e Cognome (chi compila il diario)</label>
        <input id="patientName" type="text" placeholder="Es. Mario Rossi" />
        <div class="helper">Questo nome verr√† riportato nell‚Äôintestazione della stampa PDF.</div>
      </div>

      <!-- Nuovo attacco -->
      <div class="card" id="card-form">
        <div class="section-title">
          <h2>Nuovo attacco</h2>
          <span class="pill pill-red">Inserimento rapido</span>
        </div>

        <form id="attackForm">
          <div class="field-row-3">
            <div>
              <label for="date">Data</label>
              <input id="date" type="date" />
            </div>

            <div>
              <label for="time">Ora (opzionale)</label>
              <input id="time" type="time" />
            </div>

            <div>
              <label for="efficacy">Efficacia</label>
              <select id="efficacy">
                <option>Parziale</option>
                <option>Buona</option>
                <option>Ottima</option>
                <option>Nessuna</option>
              </select>
            </div>
          </div>

          <div class="field-row">
            <div>
              <label for="intensity">Intensit√† (1‚Äì10)</label>
              <input id="intensity" type="number" min="1" max="10" step="1" placeholder="Es. 7" />
            </div>

            <div>
              <label for="duration">Durata (ore)</label>
              <input id="duration" type="number" min="0.5" step="0.5" placeholder="Es. 3" />
            </div>
          </div>

          <div class="field-row">
            <div>
              <label for="meds">Farmaci usati (multi-selezione)</label>
              <select id="meds" multiple size="7">
                <option value="Relpax (eletriptan)">Relpax (eletriptan)</option>
                <option value="Ibuprofene (FANS)">Ibuprofene (FANS)</option>
                <option value="Naproxene (FANS)">Naproxene (FANS)</option>
                <option value="Ketoprofene (FANS)">Ketoprofene (FANS)</option>
                <option value="Diclofenac (FANS)">Diclofenac (FANS)</option>
                <option value="Paracetamolo">Paracetamolo</option>
                <option value="Okitask (FANS)">Okitask (FANS)</option>
              </select>
              <div class="helper">Puoi selezionare pi√π voci (tieni premuto). Se non hai preso nulla, lascia vuoto.</div>
            </div>

            <div>
              <label>Trigger (seleziona)</label>
              <div id="triggerChips">
                <label><input type="checkbox" value="Stress" /> Stress</label>
                <label><input type="checkbox" value="Poco sonno" /> Poco sonno</label>
                <label><input type="checkbox" value="Meteo" /> Meteo</label>
                <label><input type="checkbox" value="Alimenti" /> Alimenti</label>
                <label><input type="checkbox" value="Ciclo" /> Ciclo</label>
                <label><input type="checkbox" value="Odori forti" /> Odori forti</label>
              </div>

              <div class="hr"></div>

              <label for="stress">Stress (0‚Äì10): <span id="stressVal" class="pill pill-cyan">0</span></label>
              <input id="stress" type="range" min="0" max="10" step="1" value="0" />

              <div class="field-row">
                <div>
                  <label for="sleepHours">Ore sonno</label>
                  <input id="sleepHours" type="number" min="0" step="0.5" placeholder="Es. 5.5" />
                </div>
                <div>
                  <label for="weather">Meteo (opzionale)</label>
                  <input id="weather" type="text" placeholder="Es. pioggia, caldo, vento..." />
                </div>
              </div>

              <label for="foods">Alimenti (opzionale)</label>
              <input id="foods" type="text" placeholder="Es. cioccolato, formaggi, vino..." />
            </div>
          </div>

          <label for="notes">Note (opzionale)</label>
          <textarea id="notes" placeholder="Es. nausea, fotofobia, riposo al buio..."></textarea>

          <div class="footer-actions">
            <button type="submit" class="btn btn-primary">‚úÖ Salva</button>
            <button id="btnClear" type="button" class="btn btn-ghost">üßπ Svuota campi</button>
          </div>
        </form>
      </div>

      <!-- Registro -->
      <div class="card" id="card-registro">
        <div class="section-title">
          <h2>Registro</h2>
          <span class="pill pill-amber">Filtri & riepilogo</span>
        </div>

        <div class="filters">
          <div style="min-width:220px">
            <label for="month">Mese</label>
            <input id="month" type="month" />
          </div>

          <div style="min-width:180px">
            <label for="onlyWeekend">Solo weekend</label>
            <select id="onlyWeekend">
              <option value="all">Tutti</option>
              <option value="weekend">Weekend</option>
              <option value="weekday">Feriali</option>
            </select>
          </div>

          <div style="flex:1; min-width:240px">
            <label for="q">Ricerca note/farmaci</label>
            <input id="q" type="text" placeholder="Relpax, nausea, FANS..." />
          </div>
        </div>

        <div class="hr"></div>

        <div id="stats" class="stats-row"></div>

        <div class="hr"></div>

        <!-- Table desktop -->
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Intensit√†</th>
                <th>Durata</th>
                <th>Farmaci</th>
                <th>Efficacia</th>
                <th>Trigger</th>
                <th>Note</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>

        <!-- Cards mobile -->
        <div id="cards"></div>

        <div class="hr"></div>

        <div class="footer-actions">
          <button id="btnExportMonth" type="button" class="btn btn-primary">üì§ Esporta mese (CSV)</button>
          <button id="btnExportAll" type="button" class="btn">üì¶ Esporta tutto (CSV)</button>
          <button id="btnDeleteAll" type="button" class="btn btn-danger">üóëÔ∏è Cancella tutto</button>
        </div>
      </div>
    </section>

    <!-- =======================
         VIEW: STATISTICHE
         ======================= -->
    <section id="view-statistiche" class="view">
      <div class="card">
        <div class="section-title">
          <h2>Statistiche mensili</h2>
          <span class="pill pill-cyan">Grafici leggibili</span>
        </div>

        <div class="filters">
          <div style="min-width:220px">
            <label for="statsMonth">Mese</label>
            <input id="statsMonth" type="month" />
          </div>

          <div style="display:flex; align-items:flex-end">
            <button id="btnRefreshCharts" type="button" class="btn btn-primary">üîÑ Aggiorna grafici</button>
          </div>
        </div>

        <div class="hr"></div>

        <div class="card-grid">
          <div class="card-sub">
            <h3>Intensit√† (max) giorno per giorno</h3>
            <div class="canvas-wrap">
              <canvas id="chartIntensity"></canvas>
            </div>
            <div class="helper">Barre: intensit√† massima del giorno.</div>
          </div>

          <div class="card-sub">
            <h3>Trigger pi√π frequenti</h3>
            <div class="canvas-wrap">
              <canvas id="chartTriggers"></canvas>
            </div>
            <div class="helper">Conteggio dei trigger selezionati o dedotti (stress alto / poco sonno ecc.).</div>
          </div>

          <div class="card-sub">
            <h3>Farmaci pi√π usati</h3>
            <div class="canvas-wrap">
              <canvas id="chartMeds"></canvas>
            </div>
            <div class="helper">Frequenza d‚Äôuso dei farmaci inseriti negli attacchi.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- =======================
         VIEW: REPORT
         ======================= -->
    <section id="view-report" class="view">
      <div class="card">
        <div class="section-title">
          <h2>Report PDF</h2>
          <span class="pill pill-amber">Centro Cefalee</span>
        </div>

        <div class="filters">
          <div style="min-width:220px">
            <label for="printMonth">Scegli mese</label>
            <input id="printMonth" type="month" />
          </div>

          <div style="display:flex; align-items:flex-end">
            <button id="btnPrintReportTop" type="button" class="btn btn-primary">üñ®Ô∏è Genera PDF / Stampa</button>
          </div>
        </div>

        <div class="hr"></div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Giorno</th>
                <th>Intensit√†</th>
                <th>Durata</th>
                <th>Farmaci</th>
                <th>Risposta</th>
                <th>Note / Trigger</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="monthlyRows"></tbody>
          </table>
        </div>

        <div class="hr"></div>

        <div class="footer-actions">
          <button id="btnPrintReportBottom" type="button" class="btn btn-primary">üñ®Ô∏è Genera PDF / Stampa</button>
        </div>
      </div>
    </section>

    <!-- =======================
         VIEW: IMPOSTAZIONI
         ======================= -->
    <section id="view-impostazioni" class="view">
      <div class="card">
        <div class="section-title">
          <h2>Impostazioni</h2>
          <span class="pill pill-violet">Aspetto & dati</span>
        </div>

        <label for="themeSelect">Tema</label>
        <select id="themeSelect">
          <option value="auto">Auto (sistema)</option>
          <option value="dark">Scuro</option>
          <option value="light">Chiaro</option>
        </select>
        <div class="helper">Puoi scegliere un tema fisso oppure seguire il tema del telefono.</div>

        <div class="hr"></div>

        <div class="footer-actions">
          <button id="btnBackup" type="button" class="btn">üíæ Backup JSON</button>
          <label class="btn btn-ghost" for="fileImport" style="cursor:pointer;">
            üì• Importa JSON
          </label>
          <input id="fileImport" type="file" accept="application/json" style="display:none" />
        </div>

        <div class="helper" style="margin-top:10px;">
          Suggerimento: fai un backup prima di aggiornare il sito o cambiare dispositivo.
        </div>
      </div>

      <div class="card">
        <h2>Uso consigliato</h2>
        <div class="helper">
          Registra ogni attacco con intensit√†, durata, farmaci e trigger: i grafici e il report mensile aiutano molto il medico a valutare l‚Äôandamento.
        </div>
      </div>
    </section>

  </main>

  <script src="./app.js"></script>
</body>
</html>
